@{
    Sys_Role Sys_Role = ViewBag.Sys_Role ?? new Sys_Role();
    var MenuTreeList = new { rows = this.MenuTree.Where(o => o.State == State.Normal), total = 0 };
    string json = Newtonsoft.Json.JsonConvert.SerializeObject(MenuTreeList);
}
<!--预建窗口-->
@*<form id="datafrom" method="post" action="/@(this.ControllerName)/@(this.ActionName)?datagridid=tableList" class="panel-body panel-body-noborder window-body">
        <input type="hidden" name="id" value="@(Sys_Role.ID)" />
            <table cellpadding="5">
                <tr>
                    <td>名称</td>
                    <td style="width:290px;"><input id="Name" name="Name" value="@(Sys_Role.Name)" class="easyui-textbox" type="text" data-options="required:true,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>状态</td>
                    <td>
                        <select id="State" name="State" class="easyui-combobox" data-options="panelHeight:'auto',editable:false,width:'100%'">
                            <option value="@(State.Normal)" @(Sys_Role.State == State.Normal ? "selected" : "")>正常</option>
                            <option value="@(State.Lock)" @(Sys_Role.State == State.Lock ? "selected" : "")>停用</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>排序</td>
                    <td><input id="Sort" name="Sort" value="@(Sys_Role.Sort)" class=" easyui-textbox" type="text" data-options=" required:true,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>描述</td>
                    <td colspan="3"><input id="Describe" name="Describe" value="@(Sys_Role.Describe)" class="easyui-textbox" data-options="multiline:true,height:60,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>添加时间</td>
                    <td>
                        @(Sys_Role.AddTime != DateTime.MinValue ? Sys_Role.AddTime.ToString("yyyy-MM-dd HH:mm") : "--")
                    </td>
                </tr>
                <tr>
                    <td colspan="4" style="text-align:right;">
                        <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" onclick="javascript:$('#datafrom').submit()">提交</a>
                        <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" onclick="javascript:parent.show.CloseWindow('#ModelForm')">关闭</a>
                    </td>
                </tr>



            </table>

            
    </form>*@
<form id="datafrom" method="post" action="/@(this.ControllerName)/@(this.ActionName)?datagridid=tableList" class="panel-body panel-body-noborder window-body">
    <div id="cc" class="easyui-layout" style="width:100%;" data-options="height:$(window).height()-15">

        <div data-options="region:'west',split:true" style="width:350px;">
            <input type="hidden" name="id" value="@(Sys_Role.ID)" />
            <table cellpadding="5">
                <tr>
                    <td>名称</td>
                    <td style="width:200px;"><input id="Name" name="Name" value="@(Sys_Role.Name)" class="easyui-textbox" type="text" data-options="required:true,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>状态</td>
                    <td>
                        <select id="State" name="State" class="easyui-combobox" data-options="panelHeight:'auto',editable:false,width:'100%'">
                            <option value="@(State.Normal)" @(Sys_Role.State == State.Normal ? "selected" : "")>正常</option>
                            <option value="@(State.Lock)" @(Sys_Role.State == State.Lock ? "selected" : "")>停用</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>排序</td>
                    <td><input id="Sort" name="Sort" value="@(Sys_Role.Sort)" class=" easyui-textbox" type="text" data-options=" required:true,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>描述</td>
                    <td colspan="3"><input id="Describe" name="Describe" value="@(Sys_Role.Describe)" class="easyui-textbox" data-options="multiline:true,height:60,width:'100%'" /></td>
                </tr>
                <tr>
                    <td>添加时间</td>
                    <td>
                        @(Sys_Role.AddTime != DateTime.MinValue ? Sys_Role.AddTime.ToString("yyyy-MM-dd HH:mm") : "--")
                    </td>
                </tr>

            </table>
        </div>
        <div data-options="region:'center'" style="width:420px;">
            <table id="powerList" class="easyui-treegrid" style="width:100%;" title="权限列表"
                   data-options="
                idField:'ID',
                treeField:'Name',
                singleSelect:false,
                ctrlSelect:true,
                fitColumns:true,
                checkbox:true,
                cascadeCheck:false,
                ">
                <thead>
                    <tr>
                        <th data-options="field:'Name'">名称</th>
                        <th data-options="field:'MenuType',width:40,formatter:MenuTypeName">类型</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div data-options="region:'south'" style="height:30px;">
            <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" onclick="javascript:$('#datafrom').submit()">提交</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" onclick="javascript:parent.show.CloseWindow('#ModelForm')">关闭</a>
        </div>
    </div>
</form>
@section Scripts{
    <script>
        var json = @(this.Html.Raw(json));

        //easyui解析器
        $.parser.onComplete = function () {
            var newdata = LoadJson(json,"3,6,8");
            $('#powerList').treegrid('loadData', newdata);
            ////$('#powerList').datagrid('reload');
        
            //$('#tableList').datagrid({
            //    onSelect: function (index, row) {
            //        console.log(row.MenuIDs);
            //        var ab = LoadJson(json,row.MenuIDs);
            //        $('#powerList').treegrid('loadData', ab);
            //        $('#powerList').treegrid('reload');
            //    }
            //});

        };

        function LoadJson(data,powers)
        {
            var newdata = data;
            var powersArr;
            if(powers!=null && powers != "")
            {
                powersArr = powers.split(",");
            }
            $.each(newdata.rows, function(i,n) {
                if(parseInt(n.ParentID) != 0){
                    newdata.rows[i]._parentId = n.ParentID;
                }

                if(n.Icon!='')
                {
                    newdata.rows[i].iconCls = n.Icon;
                }
                $.each(powersArr,function(k,v)
                {
                    if(n.ID == parseInt(v))
                    {
                        newdata.rows[i].checked = true;
                    }
                });
            
            });

            return newdata;
        }

        $("#datafrom").submit(function () {
            if (!$('#datafrom').form('validate')) {
                return false;
            }
        });

        function MenuTypeName(value, row, index) {
            var returl = "";
            switch (value) {
                case 1:
                    returl = "目录"
                    break;
                case 2:
                    returl = "介面"
                    break;
                case 3:
                    returl = "按钮"
                    break;
                case 4:
                    returl = "权限"
                    break;
            }
            return returl;
        }
    </script>
}
